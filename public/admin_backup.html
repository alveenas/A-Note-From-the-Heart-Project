<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin</title>
  <style>
    body{font-family:sans-serif;padding:20px}
    input,button{padding:8px;margin:4px}
    .note{border:1px solid #ccc;padding:10px;margin:8px 0}
    .hidden{opacity:.5}
  </style>
</head>
<body>

<h2>Admin Portal</h2>

<input id="password" type="password" placeholder="Admin password">
<button onclick="load()">Load Data</button>

<h3>Notes</h3>
<div id="notes"></div>

<h3>Feedback</h3>
<div id="feedback"></div>

<script>
function headers(){
  return {
    "Content-Type":"application/json",
    "x-admin-password": document.getElementById("password").value.trim()
  };
}

function load(){
  fetch("/admin/data",{headers:headers()})
    .then(r=>{
      if(!r.ok) throw "unauthorized";
      return r.json();
    })
    .then(d=>{
      notes.innerHTML="";
      d.notes.forEach(n=>{
        const div=document.createElement("div");
        div.className="note"+(n.hidden?" hidden":"");
        div.innerHTML=`
          <b>${n.title}</b><br>${n.message}<br>
          reports: ${n.reportcount}<br>
          <button onclick="toggle(${n.id},${!n.hidden})">${n.hidden?"Unhide":"Hide"}</button>
          <button onclick="del(${n.id})">Delete</button>
        `;
        notes.appendChild(div);
      });

      feedback.innerHTML="";
      d.feedback.forEach(f=>{
        feedback.innerHTML+=`<div class="note">${f.message}</div>`;
      });
    })
    .catch(()=>alert("Wrong password"));
}

function toggle(id,val){
  fetch("/admin/toggleHidden",{
    method:"POST",
    headers:headers(),
    body:JSON.stringify({noteId:id,hidden:val})
  }).then(load);
}

function del(id){
  if(!confirm("Delete permanently?")) return;
  fetch("/admin/delete",{
    method:"POST",
    headers:headers(),
    body:JSON.stringify({noteId:id})
  }).then(load);
}
</script>

</body>
</html>

